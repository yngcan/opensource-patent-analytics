---
title: "Reading and Writing an Excel File in R"
author: "Paul Oldham"
date: "24 March 2015"
output: slidy_presentation
---
##Reading an Excel File

Excel is a very popular file format for sharing data. Of course Excel is not an open source programme but it is a reality out there in data land. 

To read an Excel file into R first install the package below or tick the box in the Packages list to load it. Then load the library:

```{r eval=FALSE}
install.packages(xlsx)
library(xlsx)
```

We will use the file **wipotrends** in the [patent dataset folder](https://github.com/poldham/opensource-patent-analytics/tree/master/patentdatasets) for this example. Other test datasets in the folder are **ewaste** and **solarcooking**. Download the file and save it to your computer. Then copy the file path. 

##Reading a file straight in

```{r eval=FALSE}
wipotrends1 <- read.xlsx("yourfilenamepath", sheetIndex=1, header=TRUE)
  head(wipotrends)
```

In this case

1. sheetIndex=1 tells R to read the first sheet in the series of worksheets (sheets are treated as numeric)
2. header=TRUE tells R that the worksheet includes headers and to read those in. 

##Specifying the Row to start with

In some cases there will be text before the start of the table. The second sheet of **wipotrends** demonstrates this. To import these types of tables we need to specify the row to start with. We can do this using the startRow argument. Note that to make this work make sure you change the `sheetIndex=` number to 2 in your code to read the second sheet. 


```{r eval=FALSE}
wipotrends2 <- read.xlsx("yourfilenamepath", sheetIndex=2, startRow=5, endRow=NULL)
head(wipotrends)
```

A few things to note in this code:

1. sheetIndex=2. R will read sheets in a workbook from 1 to x. This argument tells R to retrieve a specific sheet in the workbook.
2. startRow=5. This tells R where to start reading the data from in the worksheet. In the case of wipotrends, rows 1:4 are occupied with text description. The table starts at row 5. It is a good idea to inspect the head of the file before importing. 
3. endRow=NULL. This provides the option of specifying where you want R to stop reading rows. It is useful for large table. 

##Writing Excel Files

To write an excel file with the results. 

```{r eval=FALSE}
write.xlsx(wipotrends1, "yourfilenamepath_new", sheetName="Sheet1", col.names=TRUE, row.names=TRUE, append=FALSE, showNA=TRUE)
  read.xlsx("yourfilenamepath_new", sheetIndex=1)
```

This will create a new file called wipotrends_new. Note three points here. 

1. Give your file a new name if writing into the same directory. Otherwise R will overwrite your existing file. See the use of yourfilenamepath_new as the filename.
1. If you select row.names=FALSE R will write a new column with row numbers (in this case)
2. Selecting showNA=TRUE will fill any blank cells with NA. That is useful when coming back into R to tidy up and select data. 

##Writing Excel to CSV

While Excel is popular in reality it is better to use CSV across a range of software. To write results into CSV use. 

```{r eval=FALSE}
write.csv(wipotrends1, file="yourfilenamepath_new.csv")
View("wipotrends"")
```

##Getting Help and Further Resources

1. For help and additional functions in **xlsx** select the package in Packages or read the documentation on [CRAN](http://cran.r-project.org/web/packages/xlsx/index.html)
2. For additional functionality experiment with the **XLConnect** package in Packages. Read the documentation on [CRAN](http://cran.r-project.org/web/packages/XLConnect/index.html). This adds a lot of functionality in working with Excel files in R. 

