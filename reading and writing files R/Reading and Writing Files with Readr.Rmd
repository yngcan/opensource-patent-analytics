---
title: "Reading and Writing Files with Readr"
author: "Paul Oldham"
date: "10 April 2015"
output: ioslides_presentation
---

## Readr

Readr is a brand new R package that simplifies the process for reading and parsing a file in R. 

To install use: 

```{r eval=FALSE}
install.packages("readr")
```


We will start by reading in a .csv file

## Reading a .csv file

One of the important changes here is the use of an underscore in the function read_csv() rather than the standard read.csv().

library(readr)
```{r}
pizza <- read_csv("/Users/colinbarnes/Desktop/opensource-patent-analytics/datasets/pizza.csv")
pizza
```

When this command is run it will produce a result like this as the local data frame. For those who are familiar with R note that we do not need to use tbl_df to create a data frame using this approach. We also don't need to add the ubiquitous StringsAsFactors = FALSE. Hurrah!!! When we print pizza we will see that the column headers that would have been factors are now characters without any further work. This, is a good thing.

Let's print pizza

```{r}
pizza
```


Another point to note here is that the column names are as is from the original data file - so, no more remembering to type Publication.Number. This is also a good thing.  

Source: local data frame [10,000 x 8]

   Publication Number Publication Date             Title
1       US20090208610       21.08.2009             PIZZA
2       US20140020570       24.01.2014         Pizza Pan
3       US20130239763       20.09.2013      Pizza Cutter
4           EP1820402       23.08.2007    IMPROVED PIZZA
5       US20030024843       07.02.2003   Pizza separator
6        WO2002014184       22.02.2002   PIZZA SEPARATOR
7           CA2047295       08.02.1992 PIZZA PREPARATION
8           US5428898       05.07.1995      Pizza cutter
9           CA2667902       16.05.2008         PIZZA BOX
10      US20100001051       08.01.2010         PIZZA BOX
..                ...              ...               ...
Variables not shown: Priority Data (chr), IPC (chr), Applicants (chr), Inventors (chr), FP Image (lgl)

Note that this shows us only the first 10 of 10,000 rows. 

##Writing a csv file using write_csv()

Now let's write that to a new csv file that we will call pizza1.csv

```{r}
write_csv(pizza, "pizza1.csv", append = FALSE, col_names = TRUE)
```

here the data frame pizza is written to the new csv file "pizza1.csv", the append argument set to FALSE will create a new file. If it was set to TRUE it would append (add) the file to an existing file. col_names = TRUE means that the column names will be included. 

## Zipped files

Readr can also read direct from zip files using the same function read_csv(). Let's try the same thing with a zipped csv file 

```{r}
pizzazip <- read_csv("/Users/colinbarnes/Dropbox/open_source_master/datasets\ copy/pizza.csv.zip")
pizzazip
View(pizzazip)
```

You may well receive a warning "Multiple files in zip: reading 'pizza.csv'"

If you know that there is only one file in the zip file then this can be ignored. 

##Reading in multiple files

Reading in multiple files is a little more complicated

1. Because files are contained in a folder(directory) we first need to list the files in R so R will then know where to look. We use list.files() for this. If you now type espacenet in to the console it will produce a list of the file paths in that folder. 
2. In the second step we create a list object that reads the contents of each of the files using the lapply() function from base R. What lapply does is applys a function to our list of files. 
3. If we print espacenet1 we will now see the columns in a large chunk that races off the screen. 
4. We will now merge the files into a data_frame using the ldply() function from plyr 

install.packages("plyr")

ldply will take a list and combine this into a data frame. 
5. Using the tbl_df() function from dplyr

install.packages("dplyr")

We will then turn this into a data frame table as a wrapper for the local data frame we just created. If we print espacenet3 now it will show 

library(plyr)
library(dplyr)
```{r}

espacenet <- list.files("/Users/colinbarnes/Desktop/opensource-patent-analytics/datasets/espacenet_pizza_2000_2014", full.names = TRUE) 
espacenet1 <- lapply(espacenet, read.csv, header = TRUE)
espacenet2 <- ldply(espacenet1)  
espacenet4 <- tbl_df(espacenet2)
espacenet4
```

This data needs cleaning

Error in nchar(values) : invalid multibyte string 6

##Read_csv2

This is unlikely with patent data (I have never seen it) but in some countries `;` is used as the separator rather than `,`. Read_csv2 uses this separator as its default
read_csv2 uses ; for separators, instead of ,. This is common in European countries which use , as the decimal separator.


```{r}
parse_character(pubdate, )
```

